%!TEX root=finmath1.tex
\chapter{Процессы Ито}
\label{ch:ito-processes}
\chaptertoc

Это завершающая лекция про общую теорию случайных процессов.
В ней мы определим процессы Ито и процессы, удовлетворяющие стохастическим дифференциальным уравнениям.
Процессами такого типа задается большинство моделей в финансовой математике.


\section{Определение процессов Ито. Формула Ито}

\subsection{Одномерный случай}

Пусть задано фильтрованное вероятностное пространство $(\Omega, \F, \FF, \P)$, на котором определено броуновское движение $W$.
Горизонт времени может быть как конечным, так бесконечным.
Далее всё излагается для бесконечного горизонта, но для конечного результаты аналогичны.

Напомним, что $\PP^2$ обозначает%
\footnote{В предыдущей лекции мы писали $\PP^2_\infty$ или $\PP^2_T$.
Далее будем опускать нижний индекс, когда он ясен из контекста.}
пространство измеримых согласованных процессов $H$ таких, что $\int_0^t H_s^2 ds < \infty$ для всех $t\ge0$.
Символом $\PP^1$ будем обозначать пространство измеримых согласованных процессов $G$ со свойством $\int_0^t |G_s| ds < \infty$ для всех $t\ge0$.
Интегралы здесь понимаются потраекторно в смысле Лебега. 

\begin{definition}
Непрерывный согласованный процесс $X=(X_t)_{t\ge0}$ называется \emph{процессом Ито} (по отношению к броуновскому движению $W$), если он представим в виде
\begin{equation}
\label{8:ito}  
X_t = x_0 + \int_0^t G_s ds + \int_0^t H_s d W_s,
\end{equation}
где $x_0\in \R$ -- начальное значение процесса, а $G=(G_t)_{t\ge0}$ и $H=(H_t)_{t\ge0}$ -- измеримые согласованные процессы из пространств $\PP^1$ и $\PP^2$, соответственно.
Интеграл по $ds$ понимается потраекторно в смысле Лебега, а интеграл по $dW_s$ -- в смысле Ито.
\end{definition}

Выражение \eqref{8:ito} обычно записывают в дифференциальной форме
\begin{equation}
\label{8:ito-diff}
dX_t = G_t dt + H_t dW_t, \qquad X_0=x_0,
\end{equation}
и называют его \emph{стохастическим дифференциалом} процесса $X$.
Как и в формуле Ито, дифференциальная форма "--- это лишь удобная запись, под которой всегда подразумевается интегральное представление \eqref{8:ito}.

\begin{definition}
Пусть $X$ является процессом Ито с представлением \eqref{8:ito}, а $V$ является измеримым согласованным процессом таким, что $VG \in \PP^1$ и $VH \in \PP^2$.
Тогда \emph{интеграл Ито $\int_0^t V_s d X_s$} определяется как процесс
\[
\int_0^t V_s dX_s = \int_0^t V_s G_s ds + \int_0^t V_s H_s d W_s.
\]
\end{definition}

При вычислениях удобно пользоваться следующим правилом.
Обозначим $I_t = \int_0^t V_s dX_s$. Тогда в дифференциальной форме
\[
d I_t = V_t G_t dt + V_t H_t d W_t.
\]
Таким образом, $d I_t$ получается формальным умножения $V_t$ на $dX_t$.

\begin{theorem}[формула Ито]
Пусть $X$ -- процесс Ито вида \eqref{8:ito}, а функция $f(t,x)$ непрерывна и имеет непрерывные частные производные $f'_t$, $f'_x$ и $f''_{xx}$.
Тогда процесс $Y_t = f(t,X_t)$ является процессом Ито и имеет представление
\[
d Y_t = \left(f'_t(t,X_t) + f'_x(t,X_t) G_t + \frac12 f''_{xx}(t,X_t) H_t^2 \right) dt
+ f'_x(t,X_t) H_t d W_t.
\] 
\end{theorem}

\noindent
Доказательство можно найти в \S3 гл.~4 книги \cite{LiptserShiryaev74}; в курсе мы его не приводим.

\medskip
Формулу Ито удобно запомнить в таком виде:
\[
d f(t,X_t) = f'_t(t,X_t) dt + f'_x(t,X_t) dX_t + \frac12 f''_{xx}(t,X_t) (dX_t)^2,
\]
где вместо $d X_t$ следует подставить выражение из \eqref{8:ito-diff} и при формальном возведении его в квадрат воспользоваться правилами
\[
\vphantom{\Big|}dt\cdot dt = 0,\qquad dt\cdot dW_t = 0,\qquad dW_t\cdot dW_t = dt
\]
(тогда $(d X_t)^2 = H_t^2 dt$).

\begin{remark}
Если $H \in \PP^2$, а $U$ -- непрерывный согласованный процесс, то $UH \in \PP^2$ (это следует из того, что непрерывная функция ограничена на отрезке).
Аналогично, если $G \in \PP^1$, то $UG \in \PP^1$, поэтому все интегралы в интегральной записи формулы Ито корректно определены.
\end{remark}

\begin{example}[процесс Орнштейна"--~Уленбека]
\emph{Процессом Орнштейна"--~Уленбека} называется процесс
\[
X_t = e^{-\mu t}x_0 + \sigma e^{-\mu t}\int_0^t e^{\mu s} dW_s, \qquad x_0>0,
\]
где $\mu>0$ и $\sigma>0$ -- параметры процесса.
Применяя формулу Ито к функции $f(t,Y_t)$ и процессу $Y_t$, заданным по формулам
\[
f(t,y) = e^{-\mu t}x_0 + \sigma e^{-\mu t} y, \qquad
dY_t = e^{\mu t} dW_t, \quad Y_0=0,
\]
находим стохастический дифференциал процесса $X_t$:
\begin{equation}
\label{8:ou}
dX_t = -\mu X_t dt + \sigma dW_t, \qquad X_0=x_0.
\end{equation}
Заметим, что получилось стохастическое дифференциальное уравнение, т.е.\ в этом равенстве процесс $X$ входит и в левую, и правую часть.

Уравнению \eqref{8:ou} можно дать физическую интерпретацию.
Пусть $X_t$ обозначает скорость частицы, которая имеет единичную массу и движется по прямой под действием случайной внешней силы и при наличии силы трения.
Формально перепишем уравнение \eqref{8:ou} в виде
\[
\frac{dX_t}{dt} = -\mu X_t + \sigma \frac{dW_t}{dt}.
\]
Величина $d X_t/dt$ -- это ускорение частицы.
По второму закону Ньютона ускорение равно сумме действующих сил.
Слагаемое $-\mu X_t$ представляет силу трения: она направлена в противоположную от движения сторону и пропорциональная скорости с коэффициентом трения $\mu$.
Величину $dW_t/dt$ можно интерпретировать как случайную силу, представляющую из себя <<белый шум>>, а коэффициент $\sigma$ задает интенсивность этого шума.
Отметим, что объекты $dX_t/dt$ и $dW_t/dt$ не имеют строгого математического смысла, но физическая интерпретация получается весьма правдоподобной.
\end{example}


\subsection{\difficult\ Многомерный случай}

Результаты этого раздела не потребуется в дальнейшей части курса, но они интересны сами по себе.

\begin{definition}
Непрерывный согласованный процесс $W=(W_t)_{t\ge 0}$, где $W_t=(W_t^1,\dots,W_t^d)$ называется \emph{$d$-мерным броуновским движением} с корреляционной матрицей $\Sigma = (\sigma_{ij})_{i,j=1}^d$, если
\begin{enumerate}
\item каждая компонента $W^i$ является стандартным броуновским движением;
\item все конечномерные распределения $(W_{t_1},\dots, W_{t_n})$ являются нормальными;
\item $\E W_t^iW_t^j = t\sigma_{ij}$ для всех $i,j=1,\dots,d$ и $t\ge0$.
\end{enumerate}
\end{definition}

Из второго свойства следует, что $\sigma_{ii}=1$.
Если $\Sigma$ -- единичная матрица, то $W$ называют \emph{стандартным} $d$-мерным броуновским движением (и тогда его компоненты независимы).

\begin{remark}
Как известно, любая корреляционная матрица симметрична и неотрицательно определена. Следовательно, существует матрица $A$ такая, что $\Sigma = A^TA$.
Тогда $d$-мерное броуновское движение с корреляционной матрицей $\Sigma$ можно представить в виде $W_t = A Z_t$, где $Z_t$ -- стандартное $d$-мерное броуновское движение.
\end{remark}

\begin{example}
Двумерное броуновское движение $W_t=(W_t^1,W_t^2)$ задается одним параметром -- коэффициентом корреляции $\rho = \E W_1^1W_1^2$.
Нетрудно проверить, что можно представить
\[
W_t^1 = Z_t^1, \qquad W_t^2 = \rho Z_t^1 + \sqrt{1-\rho^2} Z_t^2,
\]
где $Z_t = (Z_t^1,Z_t^2)$ -- стандартное двумерное броуновское движение.
\end{example}


\begin{definition}
Непрерывный согласованный процесс $X=(X_t)_{t\ge0}$, где $X_t=(X_t^1,\dots,X_t^m)$ называется \emph{процессом Ито} по отношению к $d$-мерном броуновскому движению $W$, если он представим в виде
\[
X_t^i = x_0^i + \int_0^t G_s^i ds + \sum_{j=1}^d\int_0^t H_s^{ij} d W_s^j
\]
c процессами $G^i \in \PP^1$ и $H^{ij}\in \PP^2$ ($i=1,\dots,m$, $j=1,\dots,d$). 

В дифференциальной форме пишут
\[
d X_t = G_t dt + H_t dW_t, \qquad X_0=x_0,
\]
понимая это равенство векторно: процесс $G_t$ принимает значения в $\R^m$, процесс $W_t$ в $\R^d$, а процесс $H$ в $\R^{m\times d}$.
Умножение $H_tdW_t$ производится как умножение матрицы на вектор-столбец.
\end{definition}

\begin{theorem}[многомерная формула Ито]
Пусть $X$ "--- $m$-мерный процесс Ито по отношению к $d$-мерному броуновскому движению с корреляционной матрицей $\Sigma$, а функция $f(t,x_1,\dots,x_m)$ непрерывна и имеет непрерывные первые частные производные по всем переменным, а также непрерывные вторые частные и смешанные производные по переменным $x_i$.

Тогда процесс $Y_t = f(t,X_t)$ является процессом Ито и имеет стохастический дифференциал
\[
d Y_t = f'_t(t,X_t) dt + \sum_{i=1}^m f'_{x_i}(t,X_t) dX_t^i + \frac12 \sum_{i,j=1}^m f''_{x_i x_j}(t,X_t) dX_t^i dX_t^j,
\]
где применяются следующие правила умножения дифференциалов:
\[
dt\cdot dt = 0, \qquad dt\cdot dW_t^i = 0, \qquad dW_t^i dW_t^j = \sigma_{ij} dt.
\]
\end{theorem}

%TODO В качестве более актуального примера дать экспоненту от суммы двух процессов Орнштейна-Уленбека.
\example[процесс Ширяева--Робертса]
Рассмотрим процесс
\[
X_t = e^{a W_t - \frac{a^2}{2} t} \left(x_0 + \int_0^t e^{a W_s + \frac{a^2}{2} s} dW_s\right), \qquad x_0\ge 0,
\]
где $a\neq 0$ -- константа, $W$ -- одномерное броуновское движение.
Этот процесс называется \emph{статистикой Ширяева--Робертса} и возникает в задачах, связанных с обнаружением момента изменения коэффициента сноса у броуновского движения (так называемые задачи о <<разладке>>).

Вычислим дифференциал $dX_t$. Рассмотрим процессы $Y_t = e^{a W_t + \frac{a^2}{2} t}$ и $Z_t = \int_0^t \frac{1}{Y_s} ds$.
Имеем
\[
dY_t = a Y_t d W_t, \qquad
dZ_t = \frac{1}{Y_t} dt.
\]
Так как $X_t = Y_t(x_0 + Z_t)$, то, применяя формулу Ито к функции $f(y,z) = y(x_0 + z)$, получаем
\begin{multline*}
d X_t = f'_y(Y_t,Z_t) dY_t + f'_z(Y_t,Z_t) dZ_t + f''_{yz}(Y_t,Z_t) dY_tdZ_t \\= 
aY_t(x_0+Z_t)d W_t + Y_t \frac{1}{Y_t} dt = a X_t d W_t + dt,
\end{multline*}
где воспользовались тем, что $f''_{yy} = f''_{zz} = 0$ и, следовательно, в формуле Ито не возникают члены с дифференциалами $(dY_t)^2$ и $(dZ_t)^2$.
Также учли, что $dY_tdZ_t = 0$, так как в $dZ_t$ присутствует только дифференциал $dt$ (\te\ коэффициент диффузии нулевой).

Таким образом, статистика Ширяева--Робертса удовлетворяет уравнению
\[
dX_t = dt + a X_t d W_t, \qquad X_0 = x_0.
\]


\section{Стохастические дифференциальные уравнения}

\begin{definition}
Пусть на $(\Omega, \F, \FF, \P)$ задано стандартное броуновское движение $W=(W_t)_{t\ge0}$. \emph{Стохастическим дифференциальным уравнением} (кратко "--- \emph{СДУ}) называется запись вида
\begin{equation}
\label{8:sde}
dX_t = a(t,X_t) dt + b(t,X_t) dW_t, \qquad X_0 = x_0,
\end{equation}
где $x_0\in \R$ -- начальное условие, $a(t,x)$ и $b(t,x)$ -- заданные измеримые функции.

\emph{Решением} уравнения \eqref{8:sde} называется непрерывный согласованный процесс $X=(X_t)_{t\ge0}$, такой, что $a(t,X_t)\in \PP^1$, $b(t,X_t)\in \PP^2$ и для всех $t\ge 0$ выполнено равенство
\[
X_t = x_0 + \int_0^t a(s,X_s) ds + \int_0^t b(s,X_s) dW_s\ \as
\]
Говорят, что решение \emph{единственно}, если любые два решения $X$ и $X'$ неразличимы.

Аналогично определяется решение уравнения на отрезке $t\in[0,T]$.
\end{definition}

\begin{remark}
Большинство СДУ нельзя решить явно (что однако не мешает использовать их для моделирования различных явлений).
Это делает актуальными вопросы о существовании и единственности решений таких уравнений.

Определенные выше понятия решения и его единственности в литературе называются \emph{сильным} решением и \emph{сильной} (или \emph{потраекторной}) единственностью.
Сильное решение предполагает, что нужно построить процесс $X$ на заданном вероятностном пространстве с уже имеющимся броуновским движением.

Существует еще понятие \emph{слабого} решения, когда ищется и броуновское движение (на каком-то вероятностном пространстве), и решение уравнения.
Помимо потраекторной единственности существует понятие единственности \emph{по распределению}, означающее, что у любых двух процессов-решений совпадают все конечномерные распределения.

В нашем курсе понятие решения и единственности всегда будут пониматься в сильном смысле.
\end{remark}



\begin{theorem}[Ито]
\label{8:t:ito-existence}
Предположим, что существует константа $C$ такая, что  функции $a(t,x)$ и $b(t,x)$ для всех $x,y\in\R$, $t\in[0,T]$ удовлетворяют условиям
\begin{align}
\label{8:ito-cond1}
|a(t,x) - a(t,y)| + |b(t,x) - b(t,y)| &\le C|x-y|,\\
\label{8:ito-cond2}
|a(t,x)| + |b(t,x)| &\le C(1+|x|).
\end{align}
Тогда уравнение \eqref{8:sde} имеет единственное решение на отрезке $[0,T]$.

Если условия \eqref{8:ito-cond1}--\eqref{8:ito-cond2} выполнены на любом отрезке $[0,T]$ с некоторой величиной $C=C(T)$, то уравнение \eqref{8:sde} имеет единственное решение на всей положительной полуоси.
\end{theorem}

\begin{remark}
Если $a(t,x) = a(x)$, $b(t,x) = b(x)$, то условие \eqref{8:ito-cond1} влечет \eqref{8:ito-cond2}.
\end{remark}

Условия в теореме Ито являются довольно-таки ограничительными и во многих прикладных моделях они не выполнены, хотя с помощью более тонких результатов можно показать, что соответствующие уравнения имеют единственные решения.
Однако для целей нашего курса теоремы Ито будет достаточно.

\begin{theorem}
\label{8:t:markov}
Пусть СДУ \eqref{8:sde} удовлетворяет условиям теоремы Ито.
Тогда его решение является марковским процессом.
Более того, если коэффициенты $a(t,x)$ и $b(t,x)$ не зависят от времени, то этот марковский процесс является однородным.
\end{theorem}

\noindent
Доказательства теорем~\ref{8:t:ito-existence} и \ref{8:t:markov} можно найти в \S\,17--18 главы~VIII книги \cite{BulinskiShiryaev04}.


\section{Важные теоремы}

\subsection{Теорема Гирсанова}
\label{ito-pr:ss:girsanov}
Теорема Гирсанова позволяет изменять снос у броуновского движения с помощью \emph{эквивалентной замены меры} на вероятностном пространстве. 
Напомним сначала определение эквивалентных мер (с ними мы уже встречались в лекции~\ref{ch:general}).

\begin{definition}
Вероятностные меры $\P$ и $\Q$, заданные на измеримом пространстве $(\Omega,\F)$, называются \emph{эквивалентными} если для любого события $A\in\F$ равенство $\P(A)=0$ выполнено тогда и только тогда, когда $\Q(A)=0$.

Обозначение: $\P\sim\Q$.
\end{definition}

\begin{proposition}[теорема Радона--Никодима]
Если $\P\sim\Q$, то существует единственная случайная величина $Z>0$ п.н.%
\footnote{Почти наверное по каждой мере $\P$ и $\Q$.
Так как они эквивалентны и, следовательно, имеют одинаковый набор событий нулевой и единичной вероятности, то <<$\P$-\as>> равносильно <<$\Q$-\as>>.}
такая, что для любого $A\in \F$ выполнены равенства
\[
Q(A) = \E^{\P}(Z\I_A), \qquad \P(A) = \E^{\Q}\left(\frac{1}{Z}\I_A\right).
\]
Величина $Z$ называется \emph{плотностью} $\Q$ относительно $\P$. Обозначение: $Z = \frac{d\Q}{d\P}$.
\end{proposition}

Полезно запомнить формулу пересчета математических ожиданий по разным мерам:
\[
\E^{\Q} X = \E^{\P} (ZX),
\]
при условии, что эти математические ожидания существуют (на самом деле, из существования одного из них следует существование другого).
Эта формула нетрудно выводится из определения эквивалентных мер с помощью приближения случайной величины $X$ простыми случайными величинами.

\begin{proposition}
Пусть $Z>0$ $\P$-п.н., и $\E^{\P} Z = 1$. Тогда функция множеств $Q(A) = \E^{\P}(Z\I_A)$, где $A\in \F$, задает вероятностную меру $Q$, эквивалентную $\P$, причем $Z = d\Q/d\P$.
\end{proposition}

Для так определенной меры $\Q$ используют запись $d\Q = Z d\P$.
Тогда, если представлять математическое ожидание как интеграл Лебега, то  формула для пересчета математических ожиданий становится простым правилом замены дифференциала под интегралом: $\int_\Omega X d\Q = \int_\Omega X Zd\P$.

\begin{theorem}[теорема Гирсанова]
Пусть на $(\Omega, \F, \FF, \P)$ задано стандартное броуновское движение $W=(W_t)_{t\in[0,T]}$, где горизонт времени $T$ может быть как конечным, так и бесконечным.
Пусть также задан измеримый согласованный процесс $\mu = (\mu_t)_{t\in[0,T]}$ такой, что для величины
\[
Z = \exp\left\{-\int_0^T \mu_t d W_t - \frac12 \int_0^T \mu_t^2 dt\right\}
\]
выполнено условие $\E^{\P} Z = 1$. 

Определим новую вероятностную меру $\Q\sim\P$ по формуле $d\Q = Zd\P$.
Тогда процесс $\tilde W_t = \int_0^t \mu_s ds + W_t$, $t\in[0,T]$, является броуновским движением относительно меры $\Q$.
\end{theorem}

Доказательство можно прочитать в \cite{LiptserShiryaev74}, гл.~6, \S\,3. 

\begin{example}
Пусть $X_t = \mu_1 t + \sigma W_t$ -- общее броуновское движение на конечном отрезке $[0,T]$, где процесс $W$ является стандартным броуновским движением относительно меры $\P$, а $\mu_1$ и $\sigma$ -- константы.
Положим $\nu=(\mu_1-\mu_2)/\sigma$ с некоторой константой $\mu_2$.

По теореме Гирсанова найдется мера $\Q\sim\P$ такая, что процесс $\tilde W_t = \nu t + W_t$ является броуновским относительно $\Q$.
Тогда $X_t = \mu_1t + \sigma (\tilde W_t - \nu t) = \mu_2 t + \sigma \tilde W_t$.
Таким образом, процесс $X$ является броуновским движением с другим коэффициентом сноса $\mu_2$ относительно меры $\Q$.

Теорема Гирсанова в этом случае применима, так $Z = e^{-\nu W_T - \frac{\nu^2}2 T}$ имеет логнормальное распределение, ее ожидание конечно и равно $1$.

Заметим, что в случае бесконечного горизонта времени теорема Гирсанова здесь работать не будет. 
Известно, что мера $\Q$, относительно которой $X$ является броуновским движением со сносом $\mu_2$ (на всей прямой), уже не будет эквивалентна мере $\P$.
Также отметим, что с помощью эквивалентной замены меры нельзя поменять коэффициент диффузии $\sigma$.
\end{example}

Нетрудно увидеть, что если $\mu_t = \mu(t)$ -- неслучайная измеримая функция, то для справедливости условия $\E^{\P} Z = 1$ необходимо и достаточно, чтобы было выполнено $\int_0^T \mu_t^2 dt < \infty$.

Когда $\mu_t$ является случайным процессом, то обычно пользуются следующим достаточным условие применимости теоремы Гирсанова.

\begin{proposition}[условие Новикова]
Пусть $\E^{\P} e^{\frac12 \int_0^T \mu_t^2 dt} < \infty$.
Тогда $\E^{\P} Z = 1$.
\end{proposition}


\subsection{Теорема о мартингальном представлении}

Пусть на $(\Omega, \F, \FF, \P)$ задано броуновское движение $W=(W_t)_{t\ge0}$, а фильтрация $\FF$ порождена им и пополнена%
\footnote{\label{8:f:brownian-filtration} Пополнение означает, что во все $\sigma$-алгебры $\F_t$ добавлены все подмножества событий нулевой вероятности. 
Известно, что пополненная фильтрация броуновского движения является непрерывной справа и, таким образом, удовлетворяет обычным условиям.}.

\begin{theorem}
Если случайная величина $X$ является $\F_T$-измеримой и $\E X^2 < \infty$, то существует единственный процесс $H\in \L^2_T$ такой, что
\begin{equation}
\label{8:martingale-representation}
X = \E X + \int_0^T H_t d W_t.
\end{equation}
Если $X$ "--- $\F_T$-измерима и $\E|X| < \infty$, то представление \eqref{8:martingale-representation} выполнено с некоторым процессом $H\in \PP^2_T$ (вообще говоря, не единственным).
\end{theorem}

Из первой части теоремы следует, что на таком вероятностном пространстве любой квадратично интегрируемый мартингал $M=(M_t)_{t\in[0,T]}$ представим в виде $M_t = M_0 + \int_0^t H_s d W_s$.

Приведем обобщение этого результата на локальные мартингалы (при все том же условии на фильтрацию).

\begin{theorem}
Для любого локального мартингала $M = (M_t)_{t\in[0,T]}$ найдется процесс $H\in \PP^2_T$ такой, что \as\ для всех $t\in[0,T]$ выполнено равенство
\[
M_t = M_0 + \int_0^t H_s d W_s.
\]
Этот процесс является $\P\otimes\mathrm{Leb}$-\as\ единственным, \te\ если $H'$ "--- другой процесс, с которым справедливо это представление, то $\E\int_0^T |H_t-H_t'| dt = 0$.
\end{theorem}

Доказательство см.~в \cite{Kallenberg97}, глава~16, теорема 16.10.


\subsection{Формула Фейнмана--Каца}

Пусть задан конечный момент времени $T>0$ и даны функции $a(t,x)$, $b(t,x)$, $c(t,x)$ на $[0,T]\times\R$, а также функция $f(x)$ на $\R$.
Рассмотрим уравнение с частными производными для неизвестной функции $V(t,x)$
\begin{equation}
\label{8:fc-equation}
V'_t(t,x) + a(t,x) V'_x(t,x) + \frac{b^2(t,x)}{2} V''_{xx}(t,x) = c(t,x)V(t,x),\quad
t\in[0,T],\ x\in\R
\end{equation}
и поставим для него \emph{задачу Коши} с терминальным условием\footnote{В курсе уравнений с частными производными обычно рассматривается задача Коши с начальным условием, \te\ задается значение $V(0,x)$.
В финансовой математике же обычно представляют интерес терминальные условия (см.~следующую лекцию).}
\begin{equation}
\label{8:fc-terminal}
V(T,x) = f(x),\quad x\in \R.
\end{equation}

\begin{theorem}[формула Фейнмана--Каца]
Если функции $a,b,c,f,V$ достаточно <<хорошие>> (см. замечание~\ref{8:r:feynman-kac} ниже), то справедливо представление
\begin{equation}
\label{8:fc-v}
V(t,x) = \E\left(e^{-\int_t^T c(s,X_s)ds} f(X_T) \;\bigg|\; X_t = x\right),
\end{equation}
где процесс $X$ удовлетворяет уравнению
\begin{equation}
\label{8:fc-sde}
dX_t = a(t,X_t) dt + b(t,X_t) dW_t.
\end{equation}
\end{theorem}

Формула Фейнмана--Каца дает вероятностное представление для решения уравнения с частными производными в виде математического ожидания по некоторому случайному процессу.
Это удобно, так как дает возможность пользоваться средствами теории случайных процессов (формула Ито, марковское свойство и \td). 

Можно пойти и в другую сторону: если требуется вычислить математическое ожидание некоторой функции от случайного процесса типа \eqref{8:fc-sde}, то вычисление сводится к решению уравнения с частными производными, для чего развиты численные методы.

\begin{remark}
Отметим, что в уравнении \eqref{8:fc-sde} не указано начальное условие.
Это объясняется тем, что, как было показано, решение СДУ с достаточно хорошими коэффициентами является марковским процессом при любом начальном условии.
Так как функция под знаком ожидания в \eqref{8:fc-v} зависит только от значения процесса $X$ в будущий момент времени $T$, то условное ожидание зависит только от значения $X_t$, но не зависит от значений процесса в прошлые моменты.
Поэтому $V(t,x)$ не зависит от выбора начального условия в уравнении \eqref{8:fc-sde}.
\end{remark}

\begin{remark}
\label{8:r:feynman-kac}
Когда справедлива формула Фейнмана--Каца? 

Во-первых, необходимо, чтобы существовало единственное решение уравнения \eqref{8:fc-sde} с любым начальным условием\footnote{
Под начальным условием $X_t=x$ понимается, что ищется процесс $X=(X_u)_{u\in[t,T]}$ такой, что $X_u = x + \int_t^u a(s,X_s) ds + \int_t^u b(s,X_s) dW_s$ для всех $u\in[t,T]$.}
$X_t=x$ и это решение было марковским процессом.

Во-вторых, выражение \eqref{8:fc-v} должно корректно определять функцию $V(t,x)$, \te\ условное математическое ожидание в формуле \eqref{8:fc-v} должно существовать и быть конечным.

В-третьих, если понимать уравнение \eqref{8:fc-equation} в классическом смысле, \te\ как равенство между производными, то необходимо, чтобы у функции $V(t,x)$, заданной по формуле \eqref{8:fc-v}, соответствующие производные существовали.
Если предположить, что известно, что функция $V$ непрерывна на $[0,T]\times\R$, а ее производные $V'_t,V'_x,V'_{xx}$ непрерывны на $[0,T)\times\R$, то для выполнения формулы Фейнмана--Каца достаточно следующих условий (см.\ \cite{KaratzasShreve91}, глава 5, раздел 7.B):
(a) функции $f(x)$, $c(t,x)$ непрерывны;
(b) $c(t,x)$ неотрицательна;
(c) $|f(x)| \le k_1(1+|x|^{m_1})$ для некоторых констант $k_1>0$, $m_1\ge 2$;
(d) $|V(t,x)| \le k_2 (1+|x|^{m_2})$ для некоторых констант $k_1>0$, $m_2\ge 2$.

Что касается существования производных у $V(t,x)$, то этого можно добиться, если наложить определенные условия на гладкость и скорость роста функций $a,b,f$.
Конкретный набор условий можно найти, например, в книге \cite{Krylov80} (см.~теорему 10 в главе~2, \S\,9). Однако все условия такого типа часто являются слишком ограничительными. 
Ввиду этого, в теоретических работах обычно обращаются к более слабому понятию решения уравнения \eqref{8:fc-equation} -- решению в \emph{вязкостном смысле}. В практических приложениях, в том числе в финансовой математике, часто применяют формулу Фейнмана--Каца без строгого обоснования ее применимости.
\end{remark}

\begin{example}
Рассмотрим \emph{уравнение теплопроводности}%
\[
\left\{
\begin{aligned}
&V'_t(t,x) + \frac12 V''_{xx}(t,x) = 0, \quad t\in[0,T],\ x\in\R,\\
&V(T,x) = f(x),\quad x\in \R,
\end{aligned}
\right.
\]
где функция $f(x)$ непрерывна и удовлетворяет условию $f(x) \le k(1+|x|^m)$.

Для представления решения по формуле Фейнмана--Каца нужно рассмотреть процесс $X$ с коэффициентами $a\equiv 0$, $b\equiv 1$ и взять функцию $c\equiv 0$:
\[
dX_t = dW_t.
\]
Таким образом, $X$ -- это броуновское движение, а начальное условие $X_t=x$ будет означать представление $X_T = x + \int_t^T d W_s = x + (W_T-W_t) \stackrel{d}{=} x + W_{T-t}$.
Тогда решение принимает вид
\[
V(t,x) = \E(f(X_T) \mid X_t = x) = \E f(x + W_{T-t}).
\]
Используя формулу плотности нормального распределения, получаем
\[
V(t,x) = \int_{-\infty}^{+\infty} f(x+y) \frac1{\sqrt{2\pi(T-t)}} e^{-\frac{y^2}{2(T-t)}} dy.
\]
\end{example}


\subsection{Прямое и обратное уравнения Колмогорова}
Рассмотрим стохастическое дифференциальное уравнение
\[
dX_t = a(t,X_t) dt + b(t,X_t) dW_t.
\]
Пусть функции $a(t,x)$ и $b(t,x)$ достаточно хорошие, а уравнение имеет решение, являющееся марковским процессом с переходной плотностью $p(s,x,t,y)$.

\begin{theorem}
Функция $p(s,x,t,y)$ удовлетворяет \emph{обратному уравнению Колмогорова} 
\begin{equation}
\label{8:backward}
\frac{\partial p}{\partial s} (s,x,t,y) = a(s,x) \frac{\partial p}{\partial x}(s,x,t,y)
+ \frac12 b^2(s,x) \frac{\partial^2 p}{\partial x^2}(s,x,t,y)
\end{equation}
и \emph{прямому уравнению Колмогорова} (называемому также \emph{уравнением Фоккера--Планка})
\begin{equation}
\label{8:forward}
\frac{\partial p}{\partial t}(s,x,t,y) = -\frac{\partial}{\partial y} (a(t,y) p(s,x,t,y))
+ \frac12 \frac{\partial^2}{\partial y^2} (b^2(t,y) p(s,x,t,y)).
\end{equation}
\end{theorem}

Названия <<обратное>> и <<прямое>> связаны с тем, что в первом дифференцируют по начальной точке, а во втором "--- по конечной.

\begin{remark}
Сам А.\,Н.\ Колмогоров в своей знаменитой работе \cite{Kolmogorov31}, где им были получены прямое и обратное уравнение, не оперировал с понятием стохастического дифференциального равнения, а обращался к \emph{диффузионным процессам}.
На самом деле, такие процессы тесно связаны с решениями стохастических дифференциальных уравнений.
В частности, К.~Ито и придумал стохастический интеграл, чтобы дать явную конструкцию диффузионных процессов.
\end{remark}

\begin{remark}
Положим $V(s,x) = \E (f(X_t) \mid X_s = x)$ и представим условное ожидание как интеграл по переходной плотности: $V(s,x) = \int_\R f(y) p(s,x,t,y) dy$.
Тогда, если формально (строгое обоснование трудно) поменять местами операции интегрирования и взятия частных производных, то из обратного уравнения Колмогорова получится формула Фейнмана--Каца для случая $c\equiv 0$ с точностью до переобозначения $(s,x)$ заместо $(t,y)$.
\end{remark}


\summary

\begin{itemize}
\item Процесс Ито "--- это случайный процесс, представимый в виде $dX_t = G_t dt + H_t d W_t$ (что нужно понимать в интегральном смысле), где $G$ "--- процесс из класса $\PP^1$, $H$ "--- процесс из класса $\PP^2$.

\item Интеграл по процессу Ито $I_t = \int_0^t V_s d X_s$ определяется как процесс Ито со стохастическим дифференциалом $d I_t = V_td X_t = V_t G_t dt + V_t H_t dW_t$.

\item Справедлива формула Ито для процессов Ито: если функция $f(t,x)$ непрерывна и имеет непрерывные частные производные $f'_t$, $f'_x$ и $f''_{xx}$, то 
\[
d f(t,X_t) = f'_t(t,X_t) dt + f'_x(t,X_t) dX_t + \frac12 f''_{xx}(t,X_t) (dX_t)^2,
\] 
где $(dX_t)^2 = H_t^2 dt$.

\item Для стохастического дифференциального уравнения
\[
dX_t = a(t,X_t) dt + b(t,X_t) dW_t, \qquad X_0 = x_0,
\]
верна теорема Ито: если коэффициенты удовлетворяют условию Липшица и условию не более чем линейного роста, то уравнение имеет единственное решение. Более того, решение является марковским процессом.

\item Теорема Гирсанова позволяет найти меру $\Q\sim\P$ такую, что процесс $\tilde W_t = \int_0^t\mu_s ds + W_t$ является броуновским движением относительно $\Q$ (при некотором условии на процесс $\mu_t)$.

\item Теорема о мартингальном представлении утверждает, что, если фильтрация порождена броуновским движением и пополнена, то любую $\F_T$-измеримую случайную величину $X$ с конечным вторым моментом можно представить в виде $X = \E X + \int_0^T H_t d W_t$ с некоторым процессом $H\in \L^2_T$.

\item Формула Фейнмана--Каца дает представление для решения уравнения с частными производными в виде условного математического ожидания функции, примененной к решению стохастического дифференциального уравнения.

\item Прямое и обратное уравнения Колмогорова "--- это уравнения с частными производными для переходной плотности диффузионного процесса.
\end{itemize}
